{% extends 'include/base.html' %}

{% block title %}
    공간대여 등록 페이지
{% endblock %}

{% block link %}
    <link rel="stylesheet" href="/static/css/rental/add.css" />
{% endblock %}

{% block main %}
    <main>
        <div class="mt-5">
            <h1 class="mb-4">공간대여 글 등록 페이지</h1>
            <form name="addfrm" enctype="multipart/form-data" method="post">
                <table class="table table-form">
                    <tr>
                        <td class="label-cell">
                            <label for="title" class="form-label">제목</label>
                        </td>
                        <td colspan="3" class="input-cell">
                            <input type="text" class="form-control" name="title" id="title" placeholder="제목을 입력하세요" required>
                        </td>
                        <td class="label-cell">
                            <label for="userid" class="form-label">작성자</label>
                        </td>
                        <td class="input-cell">
                            <p class="form-control" id="author">dragon</p>
                            <input type="hidden" name="userid" id="userid">
                        </td>
                    </tr>


                    <tr>
                        <td class="label-cell">
                            <label for="sigunguno" class="form-label">지역</label>
                        </td>
                        <td class="input-cell">
                            <select class="form-select" name="sigunguno" id="sigunguno" required>
                                <option value="" disabled selected>지역을 선택하세요</option>
                                {% for region in regions %}
                                    <option value="{{ region.sigunguno }}">{{ region.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td class="label-cell">
                            <label for="sports" class="form-label">운동 종목</label>
                        </td>
                        <td class="input-cell">
                            <select class="form-select" name="sportsno" id="sports" required>
                                <option value="" disabled selected>운동 종목을 선택하세요</option>
                                <option value=1>축구</option>
                                <option value=2>야구</option>
                                <option value=3>농구</option>
                                <option value=4>테니스</option>
                                <option value=5>기타</option>
                            </select>
                        </td>
                        <td class="label-cell">
                            <label for="price" class="form-label">가격</label>
                        </td>
                        <td class="input-cell">
                            <div class="input-group">
                                <input type="text" class="form-control" name="price" id="price" placeholder="최소 1만" required>
                                <span class="input-group-text">원</span>
                            </div>
                        </td>

                    </tr>
                    <tr>
                        <td class="label-cell">
                            <label for="address" class="form-label">주소</label>
                        </td>
                        <td class="input-cell" colspan="2">
                            <input type="text" class="form-control" name="address" id="address" placeholder="주소를 입력하세요" required>
                            <button type="button" onclick="searchAddress()">주소 확인</button>
                            <!-- 숨겨진 필드 추가 -->
                            <input type="hidden" name="latitude" id="latitude">
                            <input type="hidden" name="longitude" id="longitude">
                        </td>

                        <td class="label-cell">
                            <label for="people" class="form-label">인원수</label>
                        </td>
                        <td class="input-cell">
                            <input type="number" class="form-control" name="people" id="people" placeholder="최대인원수를 입력하세요" min="1" max="40" required>
                        </td>
                    </tr>
                    <!-- (날짜 선택 UI) -->
                    <tr>
                        <td class="label-cell">
                            <label for="available_dates" class="form-label">사용 가능 날짜</label>
                        </td>
                        <td class="input-cell" colspan="5">
                            <input type="text" class="form-control" name="available_dates" id="available_dates" placeholder="날짜를 선택하세요" readonly required>
                        </td>
                    </tr>
                    <!-- 시간 선택 UI -->
                    <tr>
                        <td class="label-cell">
                            <label for="starttime" class="form-label">시작 시간</label>
                        </td>
                        <td class="input-cell">
                            <input type="time" class="form-control" name="starttime" id="starttime" required>
                        </td>
                        <td class="label-cell">
                            <label for="endtime" class="form-label">종료 시간</label>
                        </td>
                        <td class="input-cell">
                            <input type="time" class="form-control" name="endtime" id="endtime" required>
                        </td>
                    </tr>

                    <!-- 내용 -->
                    <tr>
                        <td class="label-cell">
                            <label for="content" class="form-label">내용</label>
                        </td>
                        <td class="input-cell" colspan="5">
                            <textarea class="form-control" name="contents" id="content" rows="4" placeholder="내용을 입력하세요" required></textarea>
                        </td>
                    </tr>

                    <!-- 첨부파일 -->
                    <tr>
                        <td class="label-cell">
                            <label class="form-label">첨부파일</label>
                        </td>
                        <td class="input-cell" colspan="5">
                            <input type="file" class="form-control mb-2" name="files" id="file1" required>
                            <input type="file" class="form-control" name="files" id="file2">
                        </td>
                    </tr>

                    <tr>
                        <td colspan="6" class="text-center">
                            <button type="submit" class="btn btn-primary" id="addbtn">등록하기</button>
                        </td>
                    </tr>
                </table>
            </form>
        </div>

    </main>

{% endblock %}


{% block script %}
    <script src="/static/js/rental/add.js"></script>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=fc8381a8e078184c69d4c4085d49468f&libraries=services"></script>
    <!-- jQuery 및 jQuery UI 추가 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script>
        $(document).ready(function () {
            var selectedDates = [];

            $("#available_dates").datepicker({
                dateFormat: "yy-mm-dd",
                minDate: new Date(),
                maxDate: "+3M",
                onSelect: function (dateText, inst) {
                    // 날짜 추가 및 제거 로직
                    if (selectedDates.includes(dateText)) {
                        // 이미 선택된 날짜를 클릭하면 제거
                        selectedDates = selectedDates.filter(date => date !== dateText);
                    } else {
                        // 선택한 날짜 추가
                        selectedDates.push(dateText);
                    }

                    // 선택된 날짜들을 쉼표로 구분하여 필드에 저장
                    $('#available_dates').val(selectedDates.join(', '));
                }
            });
        });

    </script>
{% endblock %}


