{% extends 'include/base.html' %}

{% block title %}
    공간대여 등록 페이지
{% endblock %}

{% block link %}
    <link rel="stylesheet" href="/static/css/rental/add.css" />
    <!-- jQuery UI Timepicker Addon CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.min.css" />
{% endblock %}

{% block main %}
    <main>
        <div class="mt-5">
            <h1 class="mb-4">공간대여 글 등록 페이지</h1>
            <!-- action에 라우터의 POST 엔드포인트 설정 -->
            <form name="addfrm" enctype="multipart/form-data" method="post" action="/rental/add">
                <table class="table table-form">
                    <tr>
                        <td class="label-cell">
                            <label for="title" class="form-label">제목</label>
                        </td>
                        <td colspan="3" class="input-cell">
                            <input type="text" class="form-control" name="title" id="title" placeholder="제목을 입력하세요" required>
                        </td>
                        <td class="label-cell">
                            <label for="userid" class="form-label">작성자</label>
                        </td>
                        <td class="input-cell">
                            <p class="form-control" id="author">dragon</p>
                            <input type="hidden" name="userid" id="userid">
                        </td>
                    </tr>
                    <tr>
                        <td class="label-cell">
                            <label for="sigunguno" class="form-label">지역</label>
                        </td>
                        <td class="input-cell">
                            <select class="form-select" name="sigunguno" id="sigunguno" required>
                                <option value="" disabled selected>지역을 선택하세요</option>
                                {% for region in regions %}
                                    <option value="{{ region.sigunguno }}">{{ region.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td class="label-cell">
                            <label for="sportsno" class="form-label">운동 종목</label>
                        </td>
                        <td class="input-cell">
                            <select class="form-select" name="sportsno" id="sportsno" required>
                                <option value="" disabled selected>운동 종목을 선택하세요</option>
                                <option value="1">축구</option>
                                <option value="2">야구</option>
                                <option value="3">농구</option>
                                <option value="4">테니스</option>
                                <option value="5">기타</option>
                            </select>
                        </td>
                        <td class="label-cell">
                            <label for="price" class="form-label">가격</label>
                        </td>
                        <td class="input-cell">
                            <div class="input-group">
                                <input type="text" class="form-control" name="price" id="price" placeholder="최소 1만" required>
                                <span class="input-group-text">원</span>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-cell">
                            <label for="address" class="form-label">주소</label>
                        </td>
                        <td class="input-cell" colspan="2">
                            <input type="text" class="form-control" name="address" id="address" placeholder="주소를 입력하세요" required>
                            <button type="button" onclick="searchAddress()">주소 확인</button>
                            <!-- 숨겨진 필드 추가 -->
                            <input type="hidden" name="latitude" id="latitude">
                            <input type="hidden" name="longitude" id="longitude">
                        </td>
                        <td class="label-cell">
                            <label for="people" class="form-label">인원수</label>
                        </td>
                        <td class="input-cell">
                            <input type="number" class="form-control" name="people" id="people" placeholder="최대인원수를 입력하세요" min="1" max="40" required>
                        </td>
                    </tr>
                    <!-- (날짜 선택 UI) -->
                    <tr>
                        <td class="label-cell">
                            <label for="availdate" class="form-label">사용 가능 날짜</label>
                        </td>
                        <td class="input-cell" colspan="3">
                            <input type="text" class="form-control" name="availdate" id="availdate" placeholder="날짜를 선택하세요" readonly required>
                        </td>
                    </tr>
                    <!-- 시간 선택 UI 추가 -->
                    <tr>
                        <td class="label-cell">
                            <label for="availtime" class="form-label">사용 가능 시간</label>
                        </td>
                        <td class="input-cell" colspan="3">
                            <input type="text" class="form-control" name="availtime" id="availtime" placeholder="시간을 선택하세요" readonly required>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-cell">
                            <label for="contents" class="form-label">내용</label>
                        </td>
                        <td class="input-cell" colspan="5">
                            <textarea class="form-control" name="contents" id="contents" rows="4" placeholder="내용을 입력하세요" required></textarea>
                        </td>
                    </tr>
                    <!-- 첨부파일 -->
                    <tr>
                        <td class="label-cell">
                            <label for="file1" class="form-label">첨부파일</label>
                        </td>
                        <td class="input-cell" colspan="5">
                            <input type="file" class="form-control mb-2" name="files" id="file1" required>
                            <input type="file" class="form-control" name="files" id="file2">
                        </td>
                    </tr>
                    <tr>
                        <td colspan="6" class="text-center">
                            <button type="submit" class="btn btn-primary" id="addbtn">등록하기</button>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </main>
{% endblock %}

{% block script %}
    <script src="/static/js/rental/add.js"></script>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=fc8381a8e078184c69d4c4085d49468f&libraries=services"></script>
    <!-- jQuery 및 jQuery UI 추가 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <!-- jQuery UI Timepicker Addon JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-timepicker-addon/1.6.3/jquery-ui-timepicker-addon.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script>
        $(document).ready(function () {
            var selectedDates = [];

            $("#availdate").datepicker({
                dateFormat: "yy-mm-dd",
                minDate: new Date(),
                maxDate: "+3M",
                onSelect: function (dateText, inst) {
                    if (selectedDates.includes(dateText)) {
                        selectedDates = selectedDates.filter(date => date !== dateText);
                    } else {
                        selectedDates.push(dateText);
                    }

                    $('#availdate').val(selectedDates.join(', '));
                }
            });

            // jQuery UI Timepicker 설정
            $("#availtime").timepicker({
                timeFormat: "HH:mm",
                interval: 60,
                minTime: "00:00",
                maxTime: "23:59",
                defaultTime: "00:00",
                startTime: "00:00",
                dynamic: false,
                dropdown: true,
                scrollbar: true
            });
        });
    </script>
{% endblock %}
